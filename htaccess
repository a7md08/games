# ================== SECURITY MAX LEVEL ==================

# منع عرض الموقع داخل iframe نهائيًا
Header always set X-Frame-Options "DENY"
Header always set Content-Security-Policy "frame-ancestors 'none'"

# منع XSS + MIME sniffing
Header always set X-Content-Type-Options "nosniff"
Header always set X-XSS-Protection "1; mode=block"

# منع تسريب الريفيرر
Header always set Referrer-Policy "no-referrer"

# منع التخزين المؤقت
Header always set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
Header always set Pragma "no-cache"
Header always set Expires "0"

# HTTPS إجباري
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# منع Hotlink (تشغيل الملفات من مواقع أخرى)
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https://(www\.)?https://plyr.gt.tc/ [NC]
RewriteRule \.(mp4|m3u8|ts|mpd|webm|ogg)$ - [F,L]

# منع الوصول المباشر للملفات الحساسة
<FilesMatch "\.(json|ini|log|env|sql|bak|config)$">
  Require all denied
</FilesMatch>

# منع استعراض المجلدات
Options -Indexes

# حظر أدوات الفحص والـ bots المشبوهة
RewriteCond %{HTTP_USER_AGENT} (curl|wget|python|scrapy|httpclient|libwww|bot|crawler|spider) [NC]
RewriteRule .* - [F,L]

# السماح فقط لدومينك بالوصول
<IfModule mod_headers.c>
  Header set Access-Control-Allow-Origin "https://plyr.gt.tc/"
</IfModule>

# توكن إجباري بالـ URL ( ?token=ABC123 )
RewriteCond %{QUERY_STRING} !(^|&)token=ABC123(&|$) [NC]
RewriteRule ^.*$ - [F,L]

# منع تحميل الصفحة بدون توكن
ErrorDocument 403 "ACCESS DENIED"

# ================== END ==================
